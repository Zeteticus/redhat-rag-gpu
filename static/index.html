<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Red Hat Multi-Format Documentation RAG Search</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            background: linear-gradient(135deg, #CC0000 0%, #8B0000 100%);
            min-height: 100vh;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .search-section {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            margin-bottom: 30px;
        }

        .search-form {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .search-input {
            padding: 15px;
            border: 2px solid #ddd;
            border-radius: 10px;
            font-size: 16px;
            transition: border-color 0.3s ease;
        }

        .search-input:focus {
            outline: none;
            border-color: #CC0000;
        }

        .search-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 15px 0;
        }

        .option-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .option-group label {
            font-weight: 600;
            color: #555;
        }

        .option-group select, .option-group input {
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
        }

        .search-btn {
            background: linear-gradient(135deg, #CC0000 0%, #8B0000 100%);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s ease;
        }

        .search-btn:hover {
            transform: translateY(-2px);
        }

        .search-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .results-section {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            display: none;
        }

        .results-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #eee;
        }

        .results-count {
            font-size: 18px;
            font-weight: 600;
            color: #CC0000;
        }

        .response-time {
            color: #666;
            font-size: 14px;
        }

        .result-item {
            border: 1px solid #eee;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }

        .result-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
        }

        .result-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 10px;
        }

        .result-title {
            font-size: 18px;
            font-weight: 600;
            color: #CC0000;
            margin-bottom: 5px;
            cursor: pointer;
            transition: color 0.2s ease;
            text-decoration: none;
            display: inline-block;
            tabindex: 0;
        }

        .result-title:hover {
            color: #A30000;
            text-decoration: underline;
        }

        .result-title:focus {
            outline: 2px solid #CC0000;
            outline-offset: 2px;
        }

        .result-title.clickable {
            color: #CC0000;
        }

        .result-title.clickable:hover {
            color: #A30000;
        }

        /* Page navigation buttons */
        .page-navigation {
            display: flex;
            gap: 8px;
            align-items: center;
            margin-top: 8px;
            flex-wrap: wrap;
        }

        .page-nav-btn {
            background: linear-gradient(135deg, #CC0000 0%, #8B0000 100%);
            color: white;
            border: none;
            padding: 4px 12px;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 4px;
            text-decoration: none;
        }

        .page-nav-btn:hover {
            background: linear-gradient(135deg, #A30000 0%, #660000 100%);
            transform: translateY(-1px);
        }

        .page-nav-btn:active {
            transform: translateY(0);
        }

        .page-nav-btn.primary {
            background: linear-gradient(135deg, #0066cc 0%, #004499 100%);
        }

        .page-nav-btn.primary:hover {
            background: linear-gradient(135deg, #0052a3 0%, #003366 100%);
        }

        .page-nav-btn.secondary {
            background: linear-gradient(135deg, #6c757d 0%, #495057 100%);
        }

        .page-nav-btn.secondary:hover {
            background: linear-gradient(135deg, #5a6268 0%, #3d4043 100%);
        }

        .page-indicator {
            font-size: 11px;
            color: #666;
            padding: 2px 6px;
            background: #f8f9fa;
            border-radius: 4px;
            border: 1px solid #dee2e6;
        }

        /* File type icons */
        .file-icon {
            margin-right: 8px;
            font-size: 14px;
            font-weight: bold;
        }

        .file-icon.pdf { color: #dc3545; }
        .file-icon.docx { color: #2B579A; }
        .file-icon.doc { color: #2B579A; }
        .file-icon.xlsx { color: #217346; }
        .file-icon.xls { color: #217346; }
        .file-icon.txt { color: #666; }
        .file-icon.html { color: #E34F26; }
        .file-icon.htm { color: #E34F26; }
        .file-icon.csv { color: #217346; }
        .file-icon.epub { color: #8A2BE2; }
        .file-icon.mobi { color: #FF9500; }
        .file-icon.rtf { color: #0078D4; }
        .file-icon.odt { color: #0369A1; }

        /* Loading and error states */
        .file-loading {
            opacity: 0.6;
            cursor: wait;
        }

        .file-error {
            color: #dc3545 !important;
            cursor: not-allowed;
        }

        .result-confidence {
            background: linear-gradient(135deg, #CC0000 0%, #8B0000 100%);
            color: white;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
        }

        .result-meta {
            display: flex;
            gap: 15px;
            margin-bottom: 10px;
            font-size: 14px;
            color: #666;
            flex-wrap: wrap;
        }

        .result-meta span {
            background: #f5f5f5;
            padding: 2px 8px;
            border-radius: 4px;
        }

        .result-meta .file-status {
            background: #e8f5e8;
            color: #2e7d32;
            padding: 2px 6px;
            border-radius: 3px;
            font-size: 11px;
            font-weight: 600;
        }

        .result-meta .file-status.unavailable {
            background: #ffebee;
            color: #c62828;
        }

        .result-content {
            color: #555;
            line-height: 1.6;
            margin-bottom: 10px;
        }

        .result-tags {
            display: flex;
            gap: 5px;
            flex-wrap: wrap;
        }

        .tag {
            background: #FEE;
            color: #CC0000;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 12px;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #CC0000;
            font-size: 18px;
        }

        .error {
            background: #ffebee;
            color: #c62828;
            padding: 15px;
            border-radius: 10px;
            margin: 20px 0;
            border-left: 4px solid #c62828;
        }

        .upload-section {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            margin-bottom: 30px;
        }

        .stats-section {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            margin-bottom: 30px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .stat-card {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border: 1px solid #dee2e6;
            border-radius: 10px;
            padding: 20px;
            display: flex;
            align-items: center;
            gap: 15px;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }

        .stat-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .stat-icon {
            font-size: 2em;
            width: 60px;
            height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, #CC0000 0%, #8B0000 100%);
            color: white;
            border-radius: 50%;
            box-shadow: 0 4px 10px rgba(204, 0, 0, 0.3);
        }

        .stat-content {
            flex: 1;
        }

        .stat-number {
            font-size: 2em;
            font-weight: 700;
            color: #CC0000;
            line-height: 1;
        }

        .stat-label {
            color: #666;
            font-size: 14px;
            font-weight: 500;
            margin-top: 5px;
        }

        .stats-details {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding-top: 20px;
            border-top: 1px solid #eee;
            flex-wrap: wrap;
            gap: 15px;
        }

        .gpu-status {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
            font-weight: 500;
        }

        .gpu-indicator {
            font-size: 16px;
        }

        .gpu-indicator.active {
            color: #2E7D32;
        }

        .gpu-indicator.inactive {
            color: #666;
        }

        .last-updated {
            color: #666;
            font-size: 12px;
            font-style: italic;
        }

        .upload-area {
            border: 2px dashed #ddd;
            border-radius: 10px;
            padding: 30px;
            text-align: center;
            transition: border-color 0.3s ease;
        }

        .upload-area:hover {
            border-color: #CC0000;
        }

        .upload-area.dragover {
            border-color: #CC0000;
            background-color: #FFF5F5;
        }

        .file-input {
            display: none;
        }

        .upload-btn {
            background: #4caf50;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin-top: 10px;
        }

        .supported-formats {
            margin-top: 15px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
            border: 1px solid #dee2e6;
        }

        .supported-formats h4 {
            margin-bottom: 10px;
            color: #333;
            font-size: 14px;
        }

        .format-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
        }

        .format-item {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 5px;
            border-radius: 4px;
            font-size: 12px;
        }

        .format-item.available {
            background: #e8f5e8;
            color: #2e7d32;
        }

        .format-item.unavailable {
            background: #ffebee;
            color: #c62828;
        }

        .format-status {
            font-weight: bold;
        }

        /* File type breakdown in stats */
        .file-type-breakdown {
            margin-top: 15px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
        }

        .file-type-breakdown h4 {
            margin-bottom: 10px;
            color: #333;
            font-size: 14px;
        }

        .file-type-list {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 8px;
        }

        .file-type-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 4px 8px;
            background: white;
            border-radius: 4px;
            font-size: 12px;
        }

        /* Context menu styles */
        .file-context-menu {
            position: fixed;
            background: white;
            border: 1px solid #ddd;
            border-radius: 6px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            z-index: 10001;
            padding: 8px 0;
            min-width: 180px;
        }

        .file-context-menu div {
            padding: 8px 16px;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .file-context-menu div:hover {
            background-color: #f5f5f5;
        }

        /* Notification styles */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 12px 24px;
            border-radius: 6px;
            color: white;
            font-weight: 500;
            z-index: 10000;
            transition: all 0.3s ease;
            max-width: 400px;
        }

        .notification-success {
            background-color: #2E7D32;
        }

        .notification-error {
            background-color: #D32F2F;
        }

        .notification-info {
            background-color: #CC0000;
        }

        /* Document preview modal */
        .document-preview-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            z-index: 10002;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .document-preview-modal .modal-content {
            background: white;
            width: 90%;
            height: 90%;
            max-width: 1200px;
            border-radius: 8px;
            overflow: hidden;
            position: relative;
        }

        .document-preview-modal .close-button {
            position: absolute;
            top: 10px;
            right: 10px;
            background: #CC0000;
            color: white;
            border: none;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            cursor: pointer;
            z-index: 1;
        }

        .document-preview-modal iframe {
            width: 100%;
            height: 100%;
            border: none;
        }

        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }

            .search-options {
                grid-template-columns: 1fr;
            }

            .result-header {
                flex-direction: column;
                gap: 10px;
            }

            .result-meta {
                flex-direction: column;
                gap: 5px;
            }

            .stats-grid {
                grid-template-columns: 1fr;
                gap: 15px;
            }

            .stat-card {
                padding: 15px;
            }

            .stat-icon {
                width: 50px;
                height: 50px;
                font-size: 1.5em;
            }

            .stat-number {
                font-size: 1.5em;
            }

            .stats-details {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }

            .format-grid, .file-type-list {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>🔍 Red Hat Multi-Format Documentation Search</h1>
            <p>Intelligent search powered by GPU-accelerated AI • Supports 13+ document formats</p>
            <p><strong>📖 NEW:</strong> Click page navigation buttons to jump directly to search results in documents!</p>
            <p>Not affiliated with Red Hat, Inc.</p>
        </div>

        <div class="upload-section">
            <h2 style="margin-bottom: 20px; color: #333;">📄 Upload Documents</h2>
            <div class="upload-area" onclick="document.getElementById('fileInput').click()" 
                 ondrop="handleDrop(event)" ondragover="handleDragOver(event)" ondragleave="handleDragLeave(event)">
                <p>📁 Click here or drag & drop documents to upload</p>
                <p style="margin-top: 10px; color: #666; font-size: 14px;">
                    Supports: PDF, DOCX, XLSX, TXT, HTML, CSV, EPUB, RTF, ODT, and more
                </p>
                <input type="file" id="fileInput" class="file-input" 
                       accept=".pdf,.docx,.doc,.xlsx,.xls,.txt,.html,.htm,.csv,.epub,.mobi,.rtf,.odt" 
                       multiple>
                <button class="upload-btn" onclick="uploadFiles()">Upload Selected Files</button>
            </div>
            <div id="uploadStatus"></div>
            
            <div class="supported-formats" id="supportedFormats">
                <h4>📋 Supported Document Formats</h4>
                <div class="format-grid" id="formatGrid">
                    <!-- Formats will be loaded dynamically -->
                </div>
            </div>
        </div>

        <div class="stats-section">
            <h2 style="margin-bottom: 20px; color: #333;">📊 System Statistics</h2>
            <div class="stats-grid" id="statsGrid">
                <div class="stat-card">
                    <div class="stat-icon">📚</div>
                    <div class="stat-content">
                        <div class="stat-number" id="totalDocs">-</div>
                        <div class="stat-label">Documents Processed</div>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">🔍</div>
                    <div class="stat-content">
                        <div class="stat-number" id="totalChunks">-</div>
                        <div class="stat-label">Text Chunks</div>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">⚡</div>
                    <div class="stat-content">
                        <div class="stat-number" id="totalQueries">-</div>
                        <div class="stat-label">Searches Performed</div>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">🎯</div>
                    <div class="stat-content">
                        <div class="stat-number" id="avgResponseTime">-</div>
                        <div class="stat-label">Avg Response Time</div>
                    </div>
                </div>
            </div>
            
            <div class="file-type-breakdown" id="fileTypeBreakdown">
                <h4>📂 Document Types</h4>
                <div class="file-type-list" id="fileTypeList">
                    <!-- File type breakdown will be loaded dynamically -->
                </div>
            </div>
            
            <div class="stats-details" id="statsDetails">
                <div class="gpu-status" id="gpuStatus">
                    <span class="gpu-indicator" id="gpuIndicator">🔄</span>
                    <span id="gpuText">Checking GPU status...</span>
                </div>
                <div class="last-updated" id="lastUpdated">Last updated: Loading...</div>
            </div>
        </div>

        <div class="search-section">
            <h2 style="margin-bottom: 20px; color: #333;">🔍 Search Documentation</h2>
            <form class="search-form" onsubmit="performSearch(event)">
                <input
                    type="text"
                    id="searchQuery"
                    class="search-input"
                    placeholder="Enter your search query... (e.g., 'How to configure firewall on RHEL 9')"
                    required
                >

                <div class="search-options">
                    <div class="option-group">
                        <label>Category:</label>
                        <select id="categoryFilter">
                            <option value="">All Categories</option>
                            <option value="installation">Installation</option>
                            <option value="networking">Networking</option>
                            <option value="security">Security</option>
                            <option value="storage">Storage</option>
                            <option value="virtualization">Virtualization</option>
                            <option value="containers">Containers</option>
                            <option value="troubleshooting">Troubleshooting</option>
                        </select>
                    </div>

                    <div class="option-group">
                        <label>RHEL Version:</label>
                        <select id="versionFilter">
                            <option value="">All Versions</option>
                            <option value="rhel10">RHEL 10</option>
                            <option value="rhel9">RHEL 9</option>
                            <option value="rhel8">RHEL 8</option>
                        </select>
                    </div>

                    <div class="option-group">
                        <label>File Type:</label>
                        <select id="fileTypeFilter">
                            <option value="">All Types</option>
                            <option value=".pdf">PDF Documents</option>
                            <option value=".docx">Word Documents</option>
                            <option value=".xlsx">Excel Spreadsheets</option>
                            <option value=".txt">Text Files</option>
                            <option value=".html">HTML Documents</option>
                            <option value=".csv">CSV Files</option>
                            <option value=".epub">EPUB eBooks</option>
                            <option value=".rtf">RTF Documents</option>
                            <option value=".odt">OpenDocument Text</option>
                        </select>
                    </div>

                    <div class="option-group">
                        <label>Max Results:</label>
                        <input type="number" id="maxResults" min="1" max="50" value="10">
                    </div>

                    <div class="option-group">
                        <label>Min Confidence:</label>
                        <input type="number" id="minConfidence" min="0" max="1" step="0.1" value="0.3">
                    </div>
                </div>

                <button type="submit" class="search-btn" id="searchBtn">
                    🔍 Search Documentation
                </button>
            </form>
        </div>

        <div class="results-section" id="resultsSection">
            <div class="results-header">
                <div class="results-count" id="resultsCount">0 results found</div>
                <div class="response-time" id="responseTime"></div>
            </div>
            <div id="resultsContainer"></div>
        </div>
    </div>

    <script>
        // File type icons mapping
        const FILE_TYPE_ICONS = {
            '.pdf': '📄',
            '.docx': '📝',
            '.doc': '📝',
            '.xlsx': '📊',
            '.xls': '📊',
            '.txt': '📄',
            '.html': '🌐',
            '.htm': '🌐',
            '.csv': '📈',
            '.epub': '📚',
            '.mobi': '📖',
            '.rtf': '📝',
            '.odt': '📝'
        };

        // File type names for display
        const FILE_TYPE_NAMES = {
            '.pdf': 'PDF',
            '.docx': 'Word',
            '.doc': 'Word',
            '.xlsx': 'Excel',
            '.xls': 'Excel',
            '.txt': 'Text',
            '.html': 'HTML',
            '.htm': 'HTML',
            '.csv': 'CSV',
            '.epub': 'EPUB',
            '.mobi': 'MOBI',
            '.rtf': 'RTF',
            '.odt': 'ODT'
        };

        // Drag and drop handlers
        function handleDragOver(event) {
            event.preventDefault();
            event.currentTarget.classList.add('dragover');
        }

        function handleDragLeave(event) {
            event.currentTarget.classList.remove('dragover');
        }

        function handleDrop(event) {
            event.preventDefault();
            event.currentTarget.classList.remove('dragover');
            
            const files = event.dataTransfer.files;
            const fileInput = document.getElementById('fileInput');
            fileInput.files = files;
            
            showNotification(`${files.length} file(s) selected for upload`, 'info');
        }

        function getFileIcon(fileType) {
            return FILE_TYPE_ICONS[fileType] || '📄';
        }

        function getFileTypeName(fileType) {
            return FILE_TYPE_NAMES[fileType] || fileType.toUpperCase().slice(1);
        }

        async function performSearch(event) {
            event.preventDefault();

            const query = document.getElementById('searchQuery').value;
            const category = document.getElementById('categoryFilter').value;
            const version = document.getElementById('versionFilter').value;
            const fileType = document.getElementById('fileTypeFilter').value;
            const maxResults = parseInt(document.getElementById('maxResults').value);
            const minConfidence = parseFloat(document.getElementById('minConfidence').value);

            const searchBtn = document.getElementById('searchBtn');
            const resultsSection = document.getElementById('resultsSection');
            const resultsContainer = document.getElementById('resultsContainer');

            // Show loading state
            searchBtn.disabled = true;
            searchBtn.innerHTML = '⏳ Searching...';
            resultsSection.style.display = 'block';
            resultsContainer.innerHTML = '<div class="loading">🔍 Searching through multi-format documentation...</div>';

            try {
                const filters = {};
                if (category) filters.category = category;
                if (version) filters.version = version;
                if (fileType) filters.file_type = fileType;

                const response = await fetch('/api/search', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        query: query,
                        filters: filters,
                        max_results: maxResults,
                        min_confidence: minConfidence
                    })
                });

                if (!response.ok) {
                    throw new Error(`Search failed: ${response.statusText}`);
                }

                const data = await response.json();
                displayResults(data);

                // Show page navigation help for PDFs
                setTimeout(showPageNavigationHelp, 500);

                // Refresh statistics to update query count
                setTimeout(loadStatistics, 500);

            } catch (error) {
                resultsContainer.innerHTML = `<div class="error">❌ Error: ${error.message}</div>`;
            } finally {
                searchBtn.disabled = false;
                searchBtn.innerHTML = '🔍 Search Documentation';
            }
        }

        function displayResults(data) {
            const resultsCount = document.getElementById('resultsCount');
            const responseTime = document.getElementById('responseTime');
            const resultsContainer = document.getElementById('resultsContainer');

            resultsCount.textContent = `${data.total_count} results found`;
            responseTime.textContent = `Response time: ${data.response_time_ms}ms`;

            if (data.results.length === 0) {
                resultsContainer.innerHTML = '<div class="loading">📭 No results found. Try adjusting your search terms or filters.</div>';
                return;
            }

            const resultsHTML = data.results.map(result => {
                const fileIcon = getFileIcon(result.file_type);
                const fileTypeName = getFileTypeName(result.file_type);
                const pageNavigation = generatePageNavigation(result);
                
                return `
                    <div class="result-item">
                        <div class="result-header">
                            <div>
                                <div class="result-title clickable"
                                     onclick="openDocument('${escapeHtml(result.source)}', '${result.file_type}')"
                                     title="Click to open ${fileTypeName} document"
                                     tabindex="0"
                                     onkeydown="if(event.key==='Enter') this.click()">
                                    <span class="file-icon ${result.file_type.slice(1)}">${fileIcon}</span>${escapeHtml(result.title)}
                                </div>
                                <div class="result-meta">
                                    <span>${fileIcon} ${escapeHtml(result.source)}</span>
                                    <span>📍 Page ${result.page}</span>
                                    <span>🏷️ ${escapeHtml(result.category)}</span>
                                    <span>🔧 ${escapeHtml(result.version)}</span>
                                    <span>📂 ${fileTypeName}</span>
                                </div>
                                ${pageNavigation}
                            </div>
                            <div class="result-confidence">${Math.round(result.confidence * 100)}% match</div>
                        </div>
                        <div class="result-content">${escapeHtml(result.content.substring(0, 300))}${result.content.length > 300 ? '...' : ''}</div>
                        ${result.tags.length > 0 ? `
                            <div class="result-tags">
                                ${result.tags.map(tag => `<span class="tag">${escapeHtml(tag)}</span>`).join('')}
                            </div>
                        ` : ''}
                    </div>
                `;
            }).join('');

            resultsContainer.innerHTML = resultsHTML;

            // Add file status indicators after rendering
            setTimeout(addFileStatusIndicators, 100);
        }

        // Generate page navigation buttons for a search result
        function generatePageNavigation(result) {
            const fileType = result.file_type;
            const filename = result.source;
            const page = result.page;
            const fileTypeName = getFileTypeName(fileType);
            
            // Check if this file type supports page navigation
            const supportsPageNav = ['.pdf'].includes(fileType);
            
            let navigation = '<div class="page-navigation">';
            
            if (supportsPageNav && page > 1) {
                // Go to specific page (primary action)
                navigation += `
                    <button class="page-nav-btn primary" 
                            onclick="openDocumentAtPage('${escapeHtml(filename)}', '${fileType}', ${page})"
                            title="Open ${fileTypeName} at page ${page}">
                        📖 Go to Page ${page}
                    </button>
                `;
                
                // Navigate around the page
                if (page > 1) {
                    navigation += `
                        <button class="page-nav-btn secondary" 
                                onclick="openDocumentAtPage('${escapeHtml(filename)}', '${fileType}', ${page - 1})"
                                title="Open previous page">
                            ⬅️ Page ${page - 1}
                        </button>
                    `;
                }
                
                navigation += `
                    <button class="page-nav-btn secondary" 
                            onclick="openDocumentAtPage('${escapeHtml(filename)}', '${fileType}', ${page + 1})"
                            title="Open next page">
                        ➡️ Page ${page + 1}
                    </button>
                `;
            } else if (page > 1) {
                // For non-PDF files, show page info but link to document
                navigation += `
                    <span class="page-indicator">Found on page ${page}</span>
                    <button class="page-nav-btn primary" 
                            onclick="openDocument('${escapeHtml(filename)}', '${fileType}')"
                            title="Open ${fileTypeName} document">
                        📖 Open Document
                    </button>
                `;
            } else {
                // Simple open document button
                navigation += `
                    <button class="page-nav-btn primary" 
                            onclick="openDocument('${escapeHtml(filename)}', '${fileType}')"
                            title="Open ${fileTypeName} document">
                        📖 Open Document
                    </button>
                `;
            }
            
            // Always add download option
            navigation += `
                <button class="page-nav-btn secondary" 
                        onclick="downloadDocument('${escapeHtml(filename)}')"
                        title="Download ${fileTypeName}">
                    ⬇️ Download
                </button>
            `;
            
            navigation += '</div>';
            return navigation;
        }

        // Open document at a specific page (enhanced version)
        function openDocumentAtPage(filename, fileType, page) {
            if (!filename) {
                showNotification('No filename provided', 'error');
                return;
            }

            // Construct the document URL with page parameter
            let docUrl = `/api/documents/${encodeURIComponent(filename)}`;
            
            // Add page navigation for supported formats
            if (fileType === '.pdf') {
                docUrl += `#page=${page}`;
            }

            // Show loading state
            const clickedElement = event.target;
            if (clickedElement) {
                clickedElement.style.opacity = '0.6';
                clickedElement.innerHTML = '⏳ Opening...';
            }

            // Check if the document exists before opening
            fetch(`/api/documents/${encodeURIComponent(filename)}`, { method: 'HEAD' })
                .then(response => {
                    if (response.ok) {
                        // Open document in new tab
                        const newWindow = window.open(docUrl, '_blank');
                        
                        if (!newWindow || newWindow.closed || typeof newWindow.closed == 'undefined') {
                            showNotification('Popup blocked. Please allow popups for this site.', 'error');
                            window.location.href = docUrl;
                        } else {
                            const fileTypeName = getFileTypeName(fileType);
                            showNotification(`${fileTypeName} opened at page ${page}`, 'success');
                        }
                    } else {
                        throw new Error(`Document not found: ${response.status}`);
                    }
                })
                .catch(error => {
                    console.error('Error opening document:', error);
                    showNotification(`Error opening document: ${error.message}`, 'error');
                })
                .finally(() => {
                    // Restore button state
                    if (clickedElement) {
                        clickedElement.style.opacity = '1';
                        const fileTypeName = getFileTypeName(fileType);
                        clickedElement.innerHTML = `📖 Go to Page ${page}`;
                    }
                });
        }

        // Function to open documents based on their type
        function openDocument(filename, fileType) {
            if (!filename) {
                showNotification('No filename provided', 'error');
                return;
            }

            // Show loading state
            const clickedElement = event.target.closest('.result-title');
            if (clickedElement) {
                clickedElement.classList.add('file-loading');
                clickedElement.title = 'Opening document...';
            }

            // Construct the document URL
            const docUrl = `/api/documents/${encodeURIComponent(filename)}`;

            // Check if the document exists before opening
            fetch(docUrl, { method: 'HEAD' })
                .then(response => {
                    if (response.ok) {
                        // For web-viewable formats, open in new tab
                        if (['.pdf', '.html', '.htm', '.txt', '.csv'].includes(fileType)) {
                            const newWindow = window.open(docUrl, '_blank');
                            
                            if (!newWindow || newWindow.closed || typeof newWindow.closed == 'undefined') {
                                showNotification('Popup blocked. Please allow popups for this site.', 'error');
                                window.location.href = docUrl;
                            } else {
                                showNotification(`${getFileTypeName(fileType)} opened in new tab`, 'success');
                            }
                        } else {
                            // For other formats, trigger download
                            downloadDocument(filename);
                        }
                    } else {
                        throw new Error(`Document not found: ${response.status}`);
                    }
                })
                .catch(error => {
                    console.error('Error opening document:', error);
                    showNotification(`Error opening document: ${error.message}`, 'error');

                    if (clickedElement) {
                        clickedElement.classList.add('file-error');
                        clickedElement.title = 'Document not available';
                    }
                })
                .finally(() => {
                    if (clickedElement) {
                        clickedElement.classList.remove('file-loading');
                        if (!clickedElement.classList.contains('file-error')) {
                            clickedElement.title = `Click to open ${getFileTypeName(fileType)} document`;
                        }
                    }
                });
        }

        // Utility function to show notifications
        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = `notification notification-${type}`;
            notification.textContent = message;

            document.body.appendChild(notification);

            setTimeout(() => {
                notification.style.opacity = '0';
                notification.style.transform = 'translateX(100%)';
                setTimeout(() => {
                    if (notification.parentNode) {
                        notification.parentNode.removeChild(notification);
                    }
                }, 300);
            }, 3000);
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        async function uploadFiles() {
            const fileInput = document.getElementById('fileInput');
            const uploadStatus = document.getElementById('uploadStatus');

            if (fileInput.files.length === 0) {
                uploadStatus.innerHTML = '<div class="error">Please select files first</div>';
                return;
            }

            uploadStatus.innerHTML = '<div class="loading">⬆️ Uploading files...</div>';
            let successCount = 0;

            for (const file of fileInput.files) {
                const fileExt = '.' + file.name.split('.').pop().toLowerCase();
                
                try {
                    const formData = new FormData();
                    formData.append('file', file);

                    const response = await fetch('/api/documents/upload', {
                        method: 'POST',
                        body: formData
                    });

                    if (response.ok) {
                        const result = await response.json();
                        const fileIcon = getFileIcon(fileExt);
                        uploadStatus.innerHTML += `<div style="color: green; margin: 5px 0;">✅ ${fileIcon} ${file.name} uploaded successfully (${result.file_type})</div>`;
                        successCount++;
                    } else {
                        const error = await response.text();
                        uploadStatus.innerHTML += `<div class="error">❌ Failed to upload ${file.name}: ${error}</div>`;
                    }
                } catch (error) {
                    uploadStatus.innerHTML += `<div class="error">❌ Error uploading ${file.name}: ${error.message}</div>`;
                }
            }

            fileInput.value = '';

            if (successCount > 0) {
                setTimeout(() => {
                    loadStatistics();
                    loadSupportedFormats();
                    showNotification(`${successCount} document${successCount > 1 ? 's' : ''} processed. Statistics updated.`, 'success');
                }, 2000);
            }
        }

        async function checkFileAvailability(filename) {
            try {
                const response = await fetch(`/api/documents/${encodeURIComponent(filename)}`, { method: 'HEAD' });
                return response.ok;
            } catch {
                return false;
            }
        }

        function addFileStatusIndicators() {
            document.querySelectorAll('.result-item').forEach(async (item) => {
                const titleElement = item.querySelector('.result-title');
                const metaElement = item.querySelector('.result-meta');

                if (titleElement && metaElement) {
                    const onclickAttr = titleElement.getAttribute('onclick');
                    if (onclickAttr) {
                        const match = onclickAttr.match(/'([^']+)'/);
                        if (match) {
                            const filename = match[1];
                            const isAvailable = await checkFileAvailability(filename);

                            const statusSpan = document.createElement('span');
                            statusSpan.className = `file-status ${isAvailable ? 'available' : 'unavailable'}`;
                            statusSpan.textContent = isAvailable ? '✓ Available' : '✗ Unavailable';

                            metaElement.appendChild(statusSpan);

                            if (!isAvailable) {
                                titleElement.classList.add('file-error');
                                titleElement.style.cursor = 'not-allowed';
                                titleElement.onclick = null;
                            }
                        }
                    }
                }
            });
        }

        // Context menu for documents
        document.addEventListener('contextmenu', function(event) {
            // Check if right-clicking on a result item
            const resultItem = event.target.closest('.result-item');
            if (resultItem) {
                event.preventDefault();
                
                // Extract document info from the result item
                const titleElement = resultItem.querySelector('.result-title');
                const pageElement = resultItem.querySelector('.result-meta span:nth-child(2)');
                
                if (titleElement) {
                    const onclickAttr = titleElement.getAttribute('onclick');
                    if (onclickAttr) {
                        const matches = onclickAttr.match(/'([^']+)', '([^']+)'/);
                        const pageMatch = pageElement ? pageElement.textContent.match(/Page (\d+)/) : null;
                        
                        if (matches) {
                            const filename = matches[1];
                            const fileType = matches[2];
                            const page = pageMatch ? parseInt(pageMatch[1]) : 1;
                            showDocumentContextMenu(event.pageX, event.pageY, filename, fileType, page);
                        }
                    }
                }
            }
        });

        function showDocumentContextMenu(x, y, filename, fileType, page) {
            const existingMenu = document.querySelector('.file-context-menu');
            if (existingMenu) {
                existingMenu.remove();
            }

            const menu = document.createElement('div');
            menu.className = 'file-context-menu';
            menu.style.left = x + 'px';
            menu.style.top = y + 'px';

            const fileTypeName = getFileTypeName(fileType);
            const supportsPageNav = ['.pdf'].includes(fileType);
            
            const menuItems = [];
            
            // Page-specific options for supported formats
            if (supportsPageNav && page > 1) {
                menuItems.push({ 
                    text: `📖 Open at Page ${page}`, 
                    action: () => openDocumentAtPage(filename, fileType, page) 
                });
                
                if (page > 1) {
                    menuItems.push({ 
                        text: `⬅️ Open Page ${page - 1}`, 
                        action: () => openDocumentAtPage(filename, fileType, page - 1) 
                    });
                }
                
                menuItems.push({ 
                    text: `➡️ Open Page ${page + 1}`, 
                    action: () => openDocumentAtPage(filename, fileType, page + 1) 
                });
                
                menuItems.push({ 
                    text: `📄 Open Full Document`, 
                    action: () => openDocument(filename, fileType) 
                });
            } else {
                menuItems.push({ 
                    text: `📖 Open ${fileTypeName}`, 
                    action: () => openDocument(filename, fileType) 
                });
            }
            
            // Common options
            menuItems.push({ 
                text: '⬇️ Download', 
                action: () => downloadDocument(filename) 
            });
            
            menuItems.push({ 
                text: '🔗 Copy Link', 
                action: () => copyDocumentLink(filename) 
            });
            
            if (supportsPageNav && page > 1) {
                menuItems.push({ 
                    text: `🔗 Copy Page ${page} Link`, 
                    action: () => copyPageLink(filename, page) 
                });
            }

            menuItems.forEach(item => {
                const menuItem = document.createElement('div');
                menuItem.textContent = item.text;
                menuItem.onclick = () => {
                    item.action();
                    menu.remove();
                };
                menu.appendChild(menuItem);
            });

            document.body.appendChild(menu);

            setTimeout(() => {
                document.addEventListener('click', function removeMenu() {
                    menu.remove();
                    document.removeEventListener('click', removeMenu);
                });
            }, 100);
        }

        // Copy page-specific link
        function copyPageLink(filename, page) {
            const fullUrl = `${window.location.origin}/api/documents/${encodeURIComponent(filename)}#page=${page}`;

            if (navigator.clipboard) {
                navigator.clipboard.writeText(fullUrl).then(() => {
                    showNotification(`Page ${page} link copied to clipboard`, 'success');
                }).catch(() => {
                    fallbackCopyToClipboard(fullUrl);
                });
            } else {
                fallbackCopyToClipboard(fullUrl);
            }
        }

        function downloadDocument(filename) {
            const downloadUrl = `/api/documents/${encodeURIComponent(filename)}`;
            const link = document.createElement('a');
            link.href = downloadUrl;
            link.download = filename;
            link.style.display = 'none';

            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);

            showNotification(`Downloading ${filename}`, 'info');
        }

        function copyDocumentLink(filename) {
            const fullUrl = `${window.location.origin}/api/documents/${encodeURIComponent(filename)}`;

            if (navigator.clipboard) {
                navigator.clipboard.writeText(fullUrl).then(() => {
                    showNotification('Document link copied to clipboard', 'success');
                }).catch(() => {
                    fallbackCopyToClipboard(fullUrl);
                });
            } else {
                fallbackCopyToClipboard(fullUrl);
            }
        }

        function fallbackCopyToClipboard(text) {
            const textArea = document.createElement('textarea');
            textArea.value = text;
            textArea.style.position = 'fixed';
            textArea.style.opacity = '0';
            document.body.appendChild(textArea);
            textArea.select();

            try {
                document.execCommand('copy');
                showNotification('Document link copied to clipboard', 'success');
            } catch (err) {
                showNotification('Could not copy link', 'error');
            }

            document.body.removeChild(textArea);
        }

        // Load supported formats
        async function loadSupportedFormats() {
            try {
                const response = await fetch('/api/formats');
                const data = await response.json();
                
                const formatGrid = document.getElementById('formatGrid');
                formatGrid.innerHTML = '';
                
                Object.entries(data.supported_formats).forEach(([ext, info]) => {
                    const formatItem = document.createElement('div');
                    formatItem.className = `format-item ${info.available ? 'available' : 'unavailable'}`;
                    
                    const icon = getFileIcon(ext);
                    const status = info.available ? '✓' : '✗';
                    const statusClass = info.available ? 'available' : 'unavailable';
                    
                    formatItem.innerHTML = `
                        <span>${icon} ${ext.toUpperCase()}</span>
                        <span class="format-status ${statusClass}">${status}</span>
                    `;
                    
                    if (!info.available && info.reason) {
                        formatItem.title = info.reason;
                    }
                    
                    formatGrid.appendChild(formatItem);
                });
                
            } catch (error) {
                console.error('Error loading supported formats:', error);
            }
        }

        // Load and display system statistics
        async function loadStatistics() {
            try {
                const response = await fetch('/api/stats');
                if (!response.ok) {
                    throw new Error('Failed to fetch statistics');
                }

                const stats = await response.json();
                updateStatisticsDisplay(stats);

            } catch (error) {
                console.error('Error loading statistics:', error);
                updateStatisticsDisplay({
                    total_documents: '?',
                    total_chunks: '?',
                    total_queries: '?',
                    avg_response_time_ms: '?',
                    gpu_enabled: false,
                    gpu_info: null,
                    last_updated: new Date().toISOString(),
                    file_types: {}
                });
            }
        }

        function updateStatisticsDisplay(stats) {
            // Update stat cards
            document.getElementById('totalDocs').textContent = stats.total_documents || 0;
            document.getElementById('totalChunks').textContent = formatNumber(stats.total_chunks || 0);
            document.getElementById('totalQueries').textContent = formatNumber(stats.total_queries || 0);

            // Format response time
            const avgTime = stats.avg_response_time_ms || 0;
            document.getElementById('avgResponseTime').textContent = avgTime > 0 ? `${avgTime}ms` : '-';

            // Update GPU status
            const gpuIndicator = document.getElementById('gpuIndicator');
            const gpuText = document.getElementById('gpuText');

            if (stats.gpu_enabled) {
                gpuIndicator.textContent = '🟢';
                gpuIndicator.className = 'gpu-indicator active';
                gpuText.textContent = `GPU Active: ${stats.gpu_info || 'GPU Enabled'}`;
                gpuText.style.color = '#2E7D32';
            } else {
                gpuIndicator.textContent = '🔴';
                gpuIndicator.className = 'gpu-indicator inactive';
                gpuText.textContent = 'CPU Mode (No GPU)';
                gpuText.style.color = '#666';
            }

            // Update file type breakdown
            const fileTypeList = document.getElementById('fileTypeList');
            fileTypeList.innerHTML = '';
            
            if (stats.file_types && Object.keys(stats.file_types).length > 0) {
                Object.entries(stats.file_types).forEach(([fileType, count]) => {
                    const fileTypeItem = document.createElement('div');
                    fileTypeItem.className = 'file-type-item';
                    
                    const icon = getFileIcon(fileType);
                    const name = getFileTypeName(fileType);
                    
                    fileTypeItem.innerHTML = `
                        <span>${icon} ${name}</span>
                        <span>${count}</span>
                    `;
                    
                    fileTypeList.appendChild(fileTypeItem);
                });
            } else {
                fileTypeList.innerHTML = '<div style="color: #666; font-style: italic;">No documents processed yet</div>';
            }

            // Update last updated timestamp
            const lastUpdated = document.getElementById('lastUpdated');
            if (stats.last_updated) {
                const date = new Date(stats.last_updated);
                lastUpdated.textContent = `Last updated: ${date.toLocaleString()}`;
            } else {
                lastUpdated.textContent = `Last updated: ${new Date().toLocaleString()}`;
            }
        }

        function formatNumber(num) {
            if (typeof num !== 'number') return num;
            return num.toLocaleString();
        }

        // Add example searches with multi-format awareness
        window.addEventListener('load', function() {
            const examples = [
                'How to configure firewall rules in RHEL 9',
                'Setting up SELinux policies',
                'Podman container management',
                'Network configuration with NetworkManager',
                'LVM storage management',
                'Python scripting automation',
                'Database administration guides',
                'System monitoring and logging'
            ];

            const searchInput = document.getElementById('searchQuery');
            let exampleIndex = 0;

            searchInput.addEventListener('focus', function() {
                if (this.value === '') {
                    this.placeholder = examples[exampleIndex % examples.length];
                    exampleIndex++;
                }
            });

            // Add keyboard shortcuts for page navigation
            document.addEventListener('keydown', function(event) {
                // Only activate shortcuts when not typing in input fields
                if (event.target.tagName === 'INPUT' || event.target.tagName === 'TEXTAREA') {
                    return;
                }
                
                // Ctrl/Cmd + Enter to open first result at specific page
                if ((event.ctrlKey || event.metaKey) && event.key === 'Enter') {
                    const firstPageBtn = document.querySelector('.page-nav-btn.primary');
                    if (firstPageBtn) {
                        firstPageBtn.click();
                        event.preventDefault();
                    }
                }
                
                // Alt + P to open first result as full document
                if (event.altKey && event.key.toLowerCase() === 'p') {
                    const firstTitle = document.querySelector('.result-title.clickable');
                    if (firstTitle) {
                        firstTitle.click();
                        event.preventDefault();
                    }
                }
            });

            // Load initial data
            loadStatistics();
            loadSupportedFormats();

            // Refresh statistics every 30 seconds
            setInterval(loadStatistics, 30000);
            
            // Show keyboard shortcuts help
            showKeyboardShortcuts();
        });

        // Show keyboard shortcuts help
        function showKeyboardShortcuts() {
            const hasResults = document.querySelector('.result-item');
            if (hasResults && !localStorage.getItem('shortcuts-shown')) {
                setTimeout(() => {
                    showNotification('💡 Tip: Use Ctrl+Enter to open first result, Alt+P for full document', 'info');
                    localStorage.setItem('shortcuts-shown', 'true');
                }, 3000);
            }
        }

        // Enhanced notification for page navigation
        function showPageNavigationHelp() {
            const pdfResults = document.querySelectorAll('[onclick*=".pdf"]').length;
            if (pdfResults > 0) {
                showNotification(`📄 Found ${pdfResults} PDF(s) with page navigation support!`, 'info');
            }
        }

        function refreshStatistics() {
            loadStatistics();
            loadSupportedFormats();
            showNotification('Statistics refreshed', 'info');
        }
    </script>
</body>
</html>
